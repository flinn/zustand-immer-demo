(this["webpackJsonpzustand-updating-draft-states-advanced-demo"]=this["webpackJsonpzustand-updating-draft-states-advanced-demo"]||[]).push([[0],{54:function(e,s,t){"use strict";t.r(s);var a=t(1),c=t(30);let n=function(e){return e.PROCESS_STARTED="PROCESS_STARTED",e.SESSION_SPAWNED="SESSION_SPAWNED",e.CONFIGS_LOADED="CONFIGS_LOADED",e.CLIENTS_INITIALIZED="CLIENTS_INITIALIZED",e.CONTEXTS_IDENTIFIED="CONTEXTS_IDENTIFIED",e.USER_INTERFACE_DISPLAYED="USER_INTERFACE_DISPLAYED",e.PROCESS_COMPLETED="PROCESS_COMPLETED",e}({});const i={PROCESS_STARTED:{description:"AppInit Process Started",percent:0},SESSION_SPAWNED:{description:"AppInit Session Spawned",percent:20},CONFIGS_LOADED:{description:"AppInit Configs Loaded",percent:30},CLIENTS_INITIALIZED:{description:"AppInit Clients Initialized",percent:50},CONTEXTS_IDENTIFIED:{description:"AppInit Contexts Identified",percent:70},USER_INTERFACE_DISPLAYED:{description:"AppInit Runtime Vendor Use Enabled",percent:90},PROCESS_COMPLETED:{description:"AppInit Process Completed",percent:100}};let r=function(e){return e.COLD_START="COLD_START",e.WARM_START="WARM_START",e.DEEP_LINK="DEEP_LINK",e}({});var l=t(10),o=t.n(l),d=t(11),b=t(31);const j=e=>{const s=e;s.use={};for(const t of Object.keys(s.getState()))s.use[t]=()=>s(e=>e[t]);return s},p=()=>{try{var e;const s=localStorage.getItem("app-init-storage");if(!s)return!0;return void 0===(null===(e=JSON.parse(s).state)||void 0===e?void 0:e.isFirstAppLaunch)}catch(s){return console.warn("Error reading localStorage, defaulting to first launch:",s),!0}},m=j(o()()(Object(b.persist)(Object(d.immer)(e=>({currentStage:n.PROCESS_STARTED,isFirstAppLaunch:p(),sessionStartupType:r.COLD_START,vendorActionMaps:{},setSessionStartupType:s=>{e(e=>{e.sessionStartupType=s})},setIsFirstAppLaunch:s=>{e(e=>{e.isFirstAppLaunch=s})},startAppInit:(s,t)=>{e(e=>{e.currentStage=n.SESSION_SPAWNED,e.isFirstAppLaunch=s,e.sessionStartupType=t})},registerVendorActionsMap:s=>{e(e=>{for(const[t,a]of Object.entries(s.actions))e.vendorActionMaps[t]?e.vendorActionMaps[t].push(a):e.vendorActionMaps[t]=[a]})},initializeFirstLaunch:()=>{e(e=>{e.isFirstAppLaunch&&console.log("\ud83c\udf89 First time app launch detected!")})},clearLocalStorage:()=>{try{localStorage.removeItem("app-init-storage"),console.log("\ud83d\uddd1\ufe0f localStorage cleared")}catch(e){console.error("Error clearing localStorage:",e)}},getLocalStorageInfo:()=>{try{var e;const s=localStorage.getItem("app-init-storage");if(!s)return{hasData:!1,dataSize:0};const t=new Blob([s]).size,a=JSON.parse(s);return{hasData:!0,dataSize:t,lastModified:void 0!==(null===(e=a.state)||void 0===e?void 0:e.isFirstAppLaunch)?"Recently":void 0}}catch(s){return console.error("Error reading localStorage info:",s),{hasData:!1,dataSize:0}}}})),{name:"app-init-storage",partialize:e=>({isFirstAppLaunch:e.isFirstAppLaunch,sessionStartupType:e.sessionStartupType}),onRehydrateStorage:()=>e=>{e&&console.log("\ud83d\udcf1 App state restored from localStorage:",{isFirstAppLaunch:e.isFirstAppLaunch,sessionStartupType:e.sessionStartupType})}}))),h=()=>{const e=m.use.currentStage(),s=m.use.sessionStartupType(),t=m.use.isFirstAppLaunch();return{currentStage:e,registerVendorActions:m(e=>e.registerVendorActionsMap),startType:s,isFirstAppLaunch:t}};const u=j(o()()(Object(d.immer)(e=>({todos:{"82471c5f-4207-4b1d-abcb-b98547e01a3e":{id:"82471c5f-4207-4b1d-abcb-b98547e01a3e",title:"Learn Zustand",done:!1},"354ee16c-bfdd-44d3-afa9-e93679bda367":{id:"354ee16c-bfdd-44d3-afa9-e93679bda367",title:"Learn Jotai",done:!1},"771c85c5-46ea-4a11-8fed-36cc2c7be344":{id:"771c85c5-46ea-4a11-8fed-36cc2c7be344",title:"Learn Valtio",done:!1},"363a4bac-083f-47f7-a0a2-aeeee153a99c":{id:"363a4bac-083f-47f7-a0a2-aeeee153a99c",title:"Learn Signals",done:!1}},toggleTodo:s=>e(e=>{e.todos[s].done=!e.todos[s].done})}))));var x=t(71),g=t(17);const O=j(o()()(Object(d.immer)(e=>({appSessionId:null,anonymousId:null,externalDeviceSessionId:null,externalUserId:null,setAppSessionId:()=>{e(e=>{e.appSessionId="ASID_".concat(Object(x.a)().slice(0,24).replace(/-/g,"")),console.log("[z] appSessionId == ".concat(e.appSessionId))})},setAnonymousId:s=>{e(e=>{e.anonymousId=null!==s&&void 0!==s?s:"ANON_".concat(Object(x.a)().slice(0,13).replace(/-/g,"")),console.log("[z] anonymousId == ".concat(e.anonymousId))})},setExternalDeviceSessionId:s=>{e(e=>{const t=null!==s&&void 0!==s?s:Object(g.a)().slice(0,20).replace(/-/g,"");e.externalDeviceSessionId="DEVICE_".concat(t),console.log("[z] externalDeviceSessionId == ".concat(e.externalDeviceSessionId))})},setExternalUserId:s=>{e(e=>{e.externalUserId=s,console.log("[z] externalUserId == ".concat(e.externalUserId))})},resetSessionIdentity:()=>{e(e=>{e.appSessionId=Object(x.a)(),e.anonymousId=Object(x.a)(),e.externalDeviceSessionId=null,e.externalUserId=null,console.log("[z] reset SessionIdentity state")})}})))),S=()=>{const e=O.use.appSessionId(),s=O.use.anonymousId(),t=O.use.externalDeviceSessionId(),c=O.use.externalUserId(),{currentStage:i,isFirstAppLaunch:r}=h(),l=O(e=>e.setAppSessionId),o=O(e=>e.setAnonymousId),d=O(e=>e.setExternalDeviceSessionId);return Object(a.useEffect)(()=>{i===n.SESSION_SPAWNED&&(l(),r&&(o(),d()))},[i,l,r,o]),{appSessionId:e,anonymousId:s,externalDeviceSessionId:t,externalUserId:c}};var I=t(2),f=t(23);j(o()()(Object(d.immer)(e=>({user:null,device:null,userLastUpdatedAt:null,deviceLastUpdatedAt:null,setUserProperties:s=>{e(e=>{e.user=s,e.userLastUpdatedAt=Date.now()})},setDeviceProperties:s=>{e(e=>{e.device=s,e.deviceLastUpdatedAt=Date.now()})},removeUserProperties:s=>{e(e=>{e.user=Object(f.omit)(e.user,s),e.userLastUpdatedAt=Date.now()})},removeDeviceProperties:s=>{e(e=>{e.device=Object(f.omit)(e.device,s),e.deviceLastUpdatedAt=Date.now()})}}))));var N=t(68),A=t(72);function v(){return{userId:A.a.string.uuid(),username:A.a.internet.username(),email:A.a.internet.email(),avatar:A.a.image.avatar(),password:A.a.internet.password(),birthdate:A.a.date.birthdate(),registeredAt:A.a.date.past()}}const y=function(){return e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,A.a.helpers.multiple(v,{count:e});var e},E=()=>O.getState();let T=!1;console.log("hasExternalUserIdBeenSet (initially)?",T),O.subscribe((e,s)=>{e.externalUserId!==s.externalUserId&&null!==e.externalUserId&&(console.log("externalUserId changed!",e.externalUserId),T=!0)});const D=(()=>{const e=N.a.create();return e.defaults.baseURL="https://jsonplaceholder.typicode.com",e.defaults.headers.common["Content-Type"]="application/json",e.defaults.headers.common.Accept="application/json",e.defaults.headers.common["X-App-Session-Id"]="".concat(E().appSessionId),e.defaults.headers.common["X-Anonymous-Id"]="".concat(E().anonymousId),e.defaults.headers.common["X-External-Device-Session-Id"]="".concat(E().externalDeviceSessionId),e.defaults.timeout=5e3,e.interceptors.request.use(async e=>{if(T){const s=E().externalUserId;console.log('setting "X-External-User-Id"',s),e.headers["X-External-User-Id"]=s}return e},e=>Promise.reject(e)),e.interceptors.response.use(async e=>{console.log("original response",e);let s=null;var t;return e.config.url.endsWith("/users")?(t=e,s={data:y(),status:200,statusText:"OK",headers:Object(I.a)({},t.headers),config:Object(I.a)({},t.config),request:Object(I.a)({},t.request)}):s=(e=>({data:v(),status:200,statusText:"OK",headers:Object(I.a)({},e.headers),config:Object(I.a)({},e.config),request:Object(I.a)({},e.request)}))(e),console.log("fake response",s),s},e=>Promise.reject(e)),e})();var w=t(60),L=t(61),C=t(32),F=t(62),R=t(70),_=t(63),U=t(64),P=t(67),k=t(69),z=t(65),M=t(66),W=t(0);const X=()=>{const e=u.use.todos(),s=u(e=>e.toggleTodo),{startType:t,isFirstAppLaunch:c,currentStage:l}=h(),{appSessionId:o,externalDeviceSessionId:d,externalUserId:b,anonymousId:j}=S(),[p,x]=Object(a.useState)([]),[I,f]=Object(a.useState)(!1),[N,A]=Object(a.useState)({hasData:!1,dataSize:0}),{setSessionStartupType:v,setIsFirstAppLaunch:y}=(e=>{let{isFirstAppLaunch:s,startType:t}=e;const c=m.use.currentStage(),i=m(e=>e.startAppInit),r=m(e=>e.setSessionStartupType),l=m(e=>e.setIsFirstAppLaunch);return Object(a.useEffect)(()=>{c===n.PROCESS_STARTED&&i(s,t)},[c,s,t,i]),{setSessionStartupType:r,setIsFirstAppLaunch:l}})({isFirstAppLaunch:c,startType:t}),E=Object(a.useCallback)(async()=>{f(!0);try{const e=await(async()=>(await D.get("/users")).data.slice(0,5))();x(e),console.log("Fetched users:",e)}catch(e){console.error("Error fetching users:",e)}finally{f(!1)}},[]),T=Object(a.useCallback)(()=>{console.log("toggleSessionStartupType",t),v(t===r.COLD_START?r.WARM_START:r.COLD_START)},[t,v]),X=Object(a.useCallback)(()=>{console.log("toggleIsFirstAppLaunch",c),y(!c)},[c,y]),B=Object(a.useCallback)(()=>{const e=Object(g.a)().slice(0,10);O.getState().setExternalUserId(e),console.log("----\x3e Setting externalUserId to be:",e)},[]),q=Object(a.useCallback)(()=>{m.getState().clearLocalStorage(),A(m.getState().getLocalStorageInfo()),window.location.reload()},[]),V=Object(a.useCallback)(()=>{A(m.getState().getLocalStorageInfo())},[]);Object(a.useEffect)(()=>{console.log("First time render of App.tsx -- [isFirstAppLaunch=".concat(c,"|initStage=").concat(l,"|startType=").concat(t,"|appSessionId=").concat(o,"]")),m.getState().initializeFirstLaunch(),A(m.getState().getLocalStorageInfo())},[]),Object(a.useEffect)(()=>{E()},[E]);const Z=Object.values(e).filter(e=>e.done).length,H=Object.values(e).length,J=H>0?Z/H*100:0,K=i[l].percent,G=i[l].description;return Object(W.jsx)(W.Fragment,{children:Object(W.jsxs)(w.a,{fluid:!0,className:"py-4",children:[Object(W.jsx)(L.a,{className:"mb-4",children:Object(W.jsxs)(C.a,{xs:12,className:"text-center mb-3",children:[Object(W.jsx)("h1",{className:"display-4 fw-bold text-primary mb-2",children:"Zustand + Immer Demo"}),Object(W.jsx)("p",{className:"lead text-muted",children:"Application Initialization & State Management Dashboard"})]})}),Object(W.jsx)(L.a,{className:"g-4 p-1 mb-2 bg-info-subtle text-white",children:Object(W.jsxs)(C.a,{xs:12,className:"text-center",children:[Object(W.jsxs)("p",{className:"h3",children:[G," ",Object(W.jsx)("em",{children:"(".concat(K,"% Complete)")})]}),Object(W.jsx)(F.a,{now:K,className:"mb-4 p-1",style:{height:45},variant:"info",animated:!0,striped:!0})]})}),Object(W.jsxs)(L.a,{className:"g-4 p-1",children:[Object(W.jsxs)(C.a,{lg:4,children:[Object(W.jsxs)(R.a,{className:"shadow",children:[Object(W.jsx)(R.a.Header,{className:"bg-primary text-white",children:Object(W.jsx)("p",{className:"h3 card-title mb-0",children:"\u26a1 AppInit Process Metadata"})}),Object(W.jsxs)(R.a.Body,{children:[Object(W.jsxs)("div",{className:"d-grid gap-2 mb-4",children:[Object(W.jsxs)(_.a,{variant:"secondary",size:"sm",onClick:()=>X(),children:[Object(W.jsx)("i",{className:"bi bi-check-circle me-2"}),"Toggle IsFirstAppLaunch"]}),Object(W.jsxs)(_.a,{variant:"secondary",size:"sm",onClick:()=>T(),children:[Object(W.jsx)("i",{className:"bi bi-arrow-clockwise me-2"}),"Toggle Startup Type"]}),Object(W.jsxs)(_.a,{variant:"warning",size:"lg",onClick:()=>B(),children:[Object(W.jsx)("i",{className:"bi bi-person-badge me-2"}),"Set External User ID"]})]}),Object(W.jsx)("hr",{}),Object(W.jsxs)(L.a,{className:"g-3",children:[Object(W.jsx)(C.a,{xs:12,children:Object(W.jsxs)("div",{className:"d-flex justify-content-between align-items-center p-3 bg-light rounded",children:[Object(W.jsx)("span",{className:"fw-semibold",children:"Current Stage:"}),Object(W.jsx)(U.a,{bg:"info",className:"fs-6",children:l})]})}),Object(W.jsx)(C.a,{xs:12,children:Object(W.jsxs)("div",{className:"d-flex justify-content-between align-items-center p-3 bg-light rounded",children:[Object(W.jsx)("span",{className:"fw-semibold",children:"Session Startup Type:"}),Object(W.jsx)(U.a,{bg:t===r.WARM_START?"warning":"primary",className:"fs-6",children:t})]})}),Object(W.jsx)(C.a,{xs:12,children:Object(W.jsxs)("div",{className:"d-flex justify-content-between align-items-center p-3 bg-light rounded",children:[Object(W.jsx)("span",{className:"fw-semibold",children:"Is First Time App Launched?"}),Object(W.jsx)(U.a,{bg:c?"success":"danger",className:"fs-6",children:c?"True":"False"})]})})]}),Object(W.jsxs)(P.a,{variant:"info",className:"mt-3",children:[Object(W.jsx)("i",{className:"bi bi-database me-2"}),Object(W.jsx)("strong",{children:"localStorage Persistence:"})," This state is automatically saved to your browser's localStorage and will persist between sessions."]}),Object(W.jsxs)(R.a,{className:"mt-3",children:[Object(W.jsx)(R.a.Header,{className:"bg-secondary text-white",children:Object(W.jsxs)("p",{className:"h6 card-title mb-0",children:[Object(W.jsx)("i",{className:"bi bi-gear me-2"}),"localStorage Management"]})}),Object(W.jsxs)(R.a.Body,{children:[Object(W.jsxs)("div",{className:"mb-3",children:[Object(W.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[Object(W.jsx)("span",{className:"fw-semibold",children:"Status:"}),Object(W.jsx)(U.a,{bg:N.hasData?"success":"warning",children:N.hasData?"Data Stored":"No Data"})]}),N.hasData&&Object(W.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[Object(W.jsx)("span",{className:"fw-semibold",children:"Size:"}),Object(W.jsxs)("span",{className:"text-muted",children:[N.dataSize," bytes"]})]})]}),Object(W.jsxs)("div",{className:"d-grid gap-2",children:[Object(W.jsxs)(_.a,{variant:"outline-info",size:"sm",onClick:V,children:[Object(W.jsx)("i",{className:"bi bi-arrow-clockwise me-2"}),"Refresh Info"]}),Object(W.jsxs)(_.a,{variant:"outline-danger",size:"sm",onClick:q,children:[Object(W.jsx)("i",{className:"bi bi-trash me-2"}),"Clear localStorage & Reset"]})]})]})]})]})]}),Object(W.jsxs)(R.a,{children:[Object(W.jsx)(R.a.Header,{className:"bg-primary text-white",children:Object(W.jsx)("p",{className:"h3 card-title mb-0",children:"\ud83e\udd78 Session Identity Details"})}),Object(W.jsx)(R.a.Body,{children:Object(W.jsxs)(L.a,{className:"g-3",children:[Object(W.jsx)(C.a,{xs:12,children:Object(W.jsxs)("div",{className:"d-flex justify-content-between align-items-center p-3 bg-light rounded",children:[Object(W.jsx)("span",{className:"fw-semibold",children:"App Session ID:"}),Object(W.jsx)(U.a,{bg:"info",className:"fs-6",children:o})]})}),Object(W.jsx)(C.a,{xs:12,children:Object(W.jsxs)("div",{className:"d-flex justify-content-between align-items-center p-3 bg-light rounded",children:[Object(W.jsx)("span",{className:"fw-semibold",children:"Anonymous ID:"}),Object(W.jsx)(U.a,{bg:"info",className:"fs-6",children:j})]})}),Object(W.jsx)(C.a,{xs:12,children:Object(W.jsxs)("div",{className:"d-flex justify-content-between align-items-center p-3 bg-light rounded",children:[Object(W.jsx)("span",{className:"fw-semibold",children:"External Device Session ID:"}),Object(W.jsx)(U.a,{bg:"info",className:"fs-6",children:d})]})}),Object(W.jsx)(C.a,{xs:12,children:Object(W.jsxs)("div",{className:"d-flex justify-content-between align-items-center p-3 rounded ".concat(b?"bg-success bg-opacity-10 border border-success":"bg-light"),children:[Object(W.jsx)("span",{className:"fw-semibold",children:"External User ID:"}),Object(W.jsx)(U.a,{bg:b?"success":"info",className:"fs-6",children:b||"Not Set"})]})})]})})]})]}),Object(W.jsx)(C.a,{lg:4,children:Object(W.jsxs)(R.a,{className:"shadow h-100",children:[Object(W.jsx)(R.a.Header,{className:"bg-success text-white",children:Object(W.jsxs)("p",{className:"h3 card-title mb-0",children:[Object(W.jsx)("i",{className:"bi bi-clipboard-check me-2"}),"\u2705 Learning Tasks"]})}),Object(W.jsxs)(R.a.Body,{children:[Object(W.jsx)("div",{className:"mb-4",children:Object.values(e).map(e=>Object(W.jsxs)("div",{className:"d-flex align-items-center p-3 mb-2 rounded border ".concat(e.done?"bg-success bg-opacity-10 border-success":"bg-light border-light"),children:[Object(W.jsx)(k.a.Check,{className:"me-3",type:"switch",checked:e.done,onChange:()=>s(e.id),style:{width:"1.2rem",height:"1.2rem"}}),Object(W.jsx)("span",{className:"fs-5 ".concat(e.done?"text-success text-decoration-line-through":"text-dark"),children:e.title})]},e.id))}),Object(W.jsxs)("div",{className:"bg-primary bg-opacity-10 p-3 rounded",children:[Object(W.jsxs)("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[Object(W.jsx)("span",{className:"fw-semibold text-white",children:"Task Progress"}),Object(W.jsxs)("span",{className:"fw-semibold text-white",children:[Z," ","/",H]})]}),Object(W.jsx)(F.a,{now:J,variant:"primary",style:{height:"1.5rem"},label:"".concat(Math.round(J),"%")})]})]})]})}),Object(W.jsx)(C.a,{lg:4,children:Object(W.jsxs)(R.a,{className:"shadow h-100",children:[Object(W.jsx)(R.a.Header,{className:"bg-info text-white",children:Object(W.jsxs)("p",{className:"h3 card-title mb-0",children:[Object(W.jsx)("i",{className:"bi bi-people me-2"}),"\ud83d\udedc Fetched Users"]})}),Object(W.jsxs)(R.a.Body,{children:[Object(W.jsx)("div",{className:"d-grid gap-2 mb-4",children:Object(W.jsxs)(_.a,{variant:"info",size:"lg",onClick:()=>E(),disabled:I,children:[Object(W.jsx)("i",{className:"bi bi-arrow-clockwise me-2"}),I?"Loading...":"Refresh Users"]})}),Object(W.jsx)("hr",{}),b&&Object(W.jsxs)(P.a,{variant:"success",className:"mb-3",children:[Object(W.jsx)("i",{className:"bi bi-check-circle me-2"}),Object(W.jsx)("strong",{children:"External User ID Set!"})," ","The Zustand subscription has triggered and axios interceptors will now include the",Object(W.jsx)("code",{children:"X-External-User-Id"})," ","header in all requests."]}),Object(W.jsx)("div",{className:"mb-4",children:I?Object(W.jsxs)("div",{className:"text-center p-4",children:[Object(W.jsx)(z.a,{animation:"border",variant:"info",role:"status",children:Object(W.jsx)("span",{className:"visually-hidden",children:"Loading..."})}),Object(W.jsx)("p",{className:"mt-2 text-muted",children:"Fetching users..."})]}):p.length>0?p.map((e,s)=>Object(W.jsxs)("div",{className:"d-flex align-items-center p-3 mb-2 rounded border bg-light",children:[Object(W.jsx)("div",{className:"me-3",children:Object(W.jsx)(M.a,{src:e.avatar,alt:"".concat(e.username," avatar"),roundedCircle:!0,style:{width:"3rem",height:"3rem"}})}),Object(W.jsxs)("div",{className:"flex-grow-1",children:[Object(W.jsx)("h6",{className:"mb-1 fw-bold",children:e.username}),Object(W.jsx)("p",{className:"mb-1 text-muted small",children:e.email}),Object(W.jsxs)("p",{className:"mb-0 text-muted small",children:["Registered:"," ",new Date(e.registeredAt).toLocaleDateString()]})]})]},e.userId||s)):Object(W.jsxs)("div",{className:"text-center p-4 text-muted",children:[Object(W.jsx)("i",{className:"bi bi-people fs-1 mb-3"}),Object(W.jsx)("p",{children:'No users loaded. Click "Refresh Users" to fetch data.'})]})}),Object(W.jsx)("div",{className:"bg-info bg-opacity-10 p-3 rounded",children:Object(W.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[Object(W.jsx)("span",{className:"fw-semibold text-info",children:"Total Users"}),Object(W.jsx)(U.a,{bg:"info",className:"fs-6",children:p.length})]})})]})]})})]})]})})};Object(c.createRoot)(document.getElementById("root")).render(Object(W.jsx)(a.StrictMode,{children:Object(W.jsx)(X,{})}))}},[[54,1,2]]]);
//# sourceMappingURL=main.e580c743.chunk.js.map